name: vivaldi
version: 6.7.3329.39
summary: Vivaldi Browser - Feature-packed web browser
description: |
    The web browser for techies and people who need a browser that helps them get things done.
    The user interface is fully customizable, including keyboard shortcuts, mouse gestures, and programmable macros.

    NOTE: This package is maintained by but not yet officially endorsed or supported by Vivaldi Technologies.
confinement: strict
license: Proprietary
type: app
website: https://vivaldi.com
grade: stable
base: core22
icon: vivaldi_icon.png
compression: lzo
adopt-info: vivaldi

architectures:
- build-on: amd64

# TODO: source-code
# TODO: linter problems

# These will need a different source file and I can't find a way to do that
# TODO: separate file? - build-on: armhf
# TODO: separate file? - build-on: arm64

# TODO: Test and fix:
#   * filesystem handling (downloads, etc)
#   * cups/printing
#   * wayland/x11 - support both
#   * secure-storage related stuff
#     - handling of gnome-keyring
#   * policy patch? https://git.launchpad.net/~chromium-team/chromium-browser/+git/snap-from-source/tree/build/chromium-patches/snap-policies-path.patch
#   * usb midi
#   * XDG open handling
#   * Sound
#   * DCONF

apps:
  vivaldi:
    extensions: [gnome]
    command: bin/vivaldi.launcher
    common-id: com.vivaldi.Vivaldi
    desktop: usr/share/applications/vivaldi.desktop
    plugs:
      - audio-playback
      - audio-record
      - bluez
      - browser-sandbox
      - camera
      - cups
      - desktop
      - desktop-legacy
      - hardware-observe
      - home
      - joystick
      - mount-observe
      - mpris
      - network
      - network-bind
      - network-manager
      - opengl
      - password-manager-service
      - raw-usb
      - removable-media
      - screen-inhibit-control
      - shmem
      - system-packages-doc
      - u2f-devices
      - upower-observe
      - wayland
      - x11

plugs:
  browser-sandbox:
    interface: browser-support
    allow-sandbox: true
  shmem:
    interface: shared-memory
    private: true
  chromium-ffmpeg-115016:
    interface: content
    target: $SNAP
    default-provider: chromium-ffmpeg

parts:
  vivaldi:
    plugin: dump
    after:
      - launcher
    source: https://downloads.vivaldi.com/stable/vivaldi-stable-$SNAPCRAFT_PROJECT_VERSION-$CRAFT_ARCH_BUILD_FOR-binsrc.tar.gz
    source-type: tar
    stage-packages:
      - libsecret-1-0
      - libatk1.0-0
      - libatspi2.0-0
      - libcairo2
      - libcups2
      - libcurl3-gnutls
      - libdbus-1-3
      - libdrm2
      - libexpat1
      - libgbm1
      - libglib2.0-0
      - libgtk-3-0
      - libnspr4
      - libnss3
      - libpango-1.0-0
      - libu2f-udev
      - libvulkan1
      - libx11-6
      - libxcb1
      - libxcomposite1
      - libxdamage1
      - libxext6
      - libxfixes3
      - libxkbcommon0
      - libxrandr2
      - wget
      - xdg-utils
      - libasound2
      - libgl1
    parse-info: [usr/share/appdata/vivaldi.appdata.xml]

  launcher:
    plugin: dump
    source: launcher
    organize:
      '*': bin/
